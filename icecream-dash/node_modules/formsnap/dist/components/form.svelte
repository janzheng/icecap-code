<script context="module"></script>

<script generics="T extends Validation = Validation, M = any">import { FORM_FIELD_SCHEMA } from "../helpers/get-form-schema";
import { setContext } from "svelte";
import { FORM_CONTEXT } from "../internal/index.js";
import { superForm } from "sveltekit-superforms/client";
import SuperDebug from "sveltekit-superforms/client/SuperDebug.svelte";
export let schema;
export let form;
export let options = {};
export let controlled = false;
const defaultOptions = {
  validators: schema,
  taintedMessage: null
};
const optionsWithDefaults = {
  ...defaultOptions,
  ...options
};
export let asChild = false;
export let debug = false;
function getSuperForm(controlled2, form2, options2) {
  if (controlled2) {
    return form2;
  }
  return superForm(form2, options2);
}
const superFrm = getSuperForm(controlled, form, optionsWithDefaults);
setContext(FORM_CONTEXT, superFrm);
setContext(FORM_FIELD_SCHEMA, schema);
const {
  enhance,
  form: formStore,
  allErrors,
  delayed,
  errors,
  reset,
  submitting,
  tainted,
  timeout,
  validate,
  posted,
  fields,
  message,
  formId,
  restore,
  capture
} = superFrm;
let config = {
  form: superFrm,
  schema
};
$:
  config = {
    form: superFrm,
    schema
  };
$:
  attrs = {
    "data-fs-form": "",
    "data-fs-error": $errors ? "" : void 0
  };
</script>

{#if asChild}
	<slot
		{config}
		formValues={$formStore}
		{formStore}
		form={superFrm}
		{enhance}
		allErrors={$allErrors}
		delayed={$delayed}
		errors={$errors}
		{reset}
		submitting={$submitting}
		tainted={$tainted}
		timeout={$timeout}
		{validate}
		posted={$posted}
		{fields}
		formId={$formId}
		{restore}
		{capture}
		message={$message}
	/>
{:else}
	<form
		method="POST"
		{...$$restProps}
		use:enhance
		on:input
		on:change
		on:formdata
		on:submit
		on:reset
		{...attrs}
	>
		<slot
			{config}
			{formStore}
			formValues={$formStore}
			form={superFrm}
			{enhance}
			{attrs}
			allErrors={$allErrors}
			delayed={$delayed}
			errors={$errors}
			{reset}
			submitting={$submitting}
			tainted={$tainted}
			timeout={$timeout}
			{validate}
			posted={$posted}
			{fields}
			formId={$formId}
			{restore}
			{capture}
			message={$message}
		/>
		{#if debug}
			<SuperDebug data={$formStore} />
		{/if}
	</form>
{/if}
